!function(){let w=null,x=null,D=null,T="center";const F=3e3,p=3e3,a=5e3;let i=0;const l=[],r=4,s=3e4;function k(e,t,n){if(Date.now()-i>a&&(i=Date.now(),n({status:e,data:t}),"eyesnotopen"===e)){e=Date.now();l.push(e);for(var o=Date.now();l.length&&o-l[0]>s;)l.shift();l.length>r&&n({status:"eyecheckoff",data:t})}}window.setupFaceMesh=async function(t,h,n,e,f){const y=h.getContext("2d");for(var o=t;0===o.videoWidth||0===o.videoHeight;)await new Promise(e=>setTimeout(e,100));await 0,n.setOptions({maxNumFaces:5,refineLandmarks:!0}),n.onResults(e=>{y.save(),y.clearRect(0,0,h.width,h.height),y.drawImage(e.image,0,0,h.width,h.height);var t,n,o,a,i=h.toDataURL("image/png"),l={status:"",data:i};if(1===e.multiFaceLandmarks?.length){e=e.multiFaceLandmarks[0];n=i,o=f,m=(t=e)[159],a=t[145],g=t[386],d=t[374],c=t[234],u=t[454],t=t[1],m&&a&&g&&d&&c&&u&&t?(c=Math.abs(m.y-a.y),u=Math.abs(g.y-d.y),a=c<.015&&u<.015,m.y,g.y,t.y,a&&!w?w=setTimeout(()=>{k("eyesnotopen",n,o),w=null},F):!a&&w&&(clearTimeout(w),w=null)):k("eyesnotopen",n,o);var r=i,s=f,c=(d=e)[468],u=d[133],m=d[33],g=d[159],d=d[145];if(c&&u&&m&&g&&d){c=(c.x-u.x)/(m.x-u.x);g.y,d.y;let e="center";c<.35?e="left":.7<c&&(e="right"),"center"!==e&&console.log(`Direction: ${e}, Ratio: `+c.toFixed(3)),"center"===e&&x?(clearTimeout(x),x=null,D=null,console.log("Back to center - Timer cleared")):"center"!==e&&"center"===T&&x?(clearTimeout(x),x=null,D=null,console.log("Direction changed from center, timer reset")):"center"!==e&&"center"!==T&&e!==T&&x&&(clearTimeout(x),x=null,D=null,console.log(`Direction changed from ${T} to ${e}, timer reset`)),"center"===e||x?"center"!==e&&x&&D&&(m=Date.now()-D,u=p-m,console.log(`Looking ${e} - ${u.toFixed(0)}ms remaining. Ratio: `+c.toFixed(3))):(D=Date.now(),console.log(`Looking ${e} - Timer started. Ratio: `+c.toFixed(3)),x=setTimeout(()=>{console.log(`Warning triggered after ${p}ms - `+e),k("eyesnotopen",r,s),x=null,D=null},p)),T=e}else x&&(clearTimeout(x),x=null,D=null),T="center"}y.restore(),f(l)}),async function e(){await n.send({image:t}),requestAnimationFrame(e)}()}}();