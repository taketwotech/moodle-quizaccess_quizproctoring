{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["define(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates'],\r\nfunction($, ModalFactory, ModalEvents, Templates) {\r\n    return {\r\n        init: function() {\r\n            $('.delete-icon').on('click', function(event) {\r\n                var username = $(this).data('username');\r\n                var confirmation = confirm('Delete all the Images of user \"' + username + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.delete-quiz').on('click', function(event) {\r\n                var quizname = $(this).data('quiz');\r\n                var confirmation = confirm('Delete all the Images of quiz \"' + quizname + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.delcourse').on('click', function(event) {\r\n                var coursename = $(this).data('course');\r\n                var confirmation = confirm('Delete all the Images of course \"' + coursename + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.proctoringimage').on('click', function(event) {\r\n                var attemptid = $(this).data('attemptid');\r\n                var quizid = $(this).data('quizid');\r\n                var userid = $(this).data('userid');\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n                    data: {\r\n                        attemptid: attemptid,\r\n                        userid: userid,\r\n                        quizid: quizid\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var images = JSON.parse(JSON.stringify(response));\r\n                        if (images.length > 0) {\r\n                            var data = {\r\n                                images: images.map(function(image) {\r\n                                    return {\r\n                                        url: image.img,\r\n                                        time: image.timecreated,\r\n                                        title: image.title\r\n                                    };\r\n                                })\r\n                            };\r\n\r\n                            Templates.render('quizaccess_quizproctoring/response_modal', data)\r\n                                .done(function(renderedHtml) {\r\n                                    ModalFactory.create({\r\n                                    type: ModalFactory.types.DEFAULT,\r\n                                    body: renderedHtml,\r\n                                    title: M.util.get_string('proctoringimages', 'quizaccess_quizproctoring')\r\n                                }).then(function(modal) {\r\n                                    modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                    modal.show();\r\n                                    lightbox.init();                        \r\n                                $('.image-link').on('click', function(event) {\r\n                                    var titleElement = $(this).next('.image-title');\r\n                                    var timeElement = $(this).next('.image-time');\r\n                                    titleElement.show();\r\n                                    timeElement.show();\r\n                                    setTimeout(function() {\r\n                                        titleElement.hide();\r\n                                    }, 1000);\r\n                                    \r\n                                    lightbox.start($(this)[0]);\r\n                                });\r\n                                $('.image-link').on('lightbox:open', function() {\r\n                                    $(this).next('.image-title').hide();\r\n                                });\r\n                                       \r\n                                });\r\n                            })\r\n                            .fail(function() {\r\n                                console.error('Failed to render Mustache template');\r\n                            });\r\n                        } else {\r\n                            var message = M.util.get_string('noimageswarning', 'quizaccess_quizproctoring');\r\n                            ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: message\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            $('.proctoridentity').on('click', function(event) {\r\n                event.preventDefault();\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoridentity.php',\r\n                    data: {\r\n                        attemptid: $(this).data('attemptid'),\r\n                        userid: $(this).data('userid'),\r\n                        quizid: $(this).data('quizid')\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var residentity = JSON.parse(JSON.stringify(response));\r\n                        if (residentity.success) {\r\n                            window.open(residentity.url, \"_blank\");\r\n                        } else {\r\n                            return ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: residentity.message,\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                                return null;\r\n                            });\r\n                        }\r\n                        return true;\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","init","on","event","username","this","data","confirm","preventDefault","quizname","coursename","attemptid","quizid","userid","ajax","url","M","cfg","wwwroot","dataType","success","response","images","JSON","parse","stringify","length","map","image","img","time","timecreated","title","render","done","renderedHtml","create","type","types","DEFAULT","body","util","get_string","then","modal","getRoot","hidden","destroy","bind","show","lightbox","titleElement","next","timeElement","setTimeout","hide","start","fail","console","error","message","residentity","window","open"],"mappings":"AAAAA,0CAAO,CAAC,SAAU,qBAAsB,oBAAqB,mBAC7D,SAASC,EAAGC,aAAcC,YAAaC,iBAC5B,CACHC,KAAM,WACFJ,EAAE,gBAAgBK,GAAG,SAAS,SAASC,WAC/BC,SAAWP,EAAEQ,MAAMC,KAAK,YACTC,QAAQ,kCAAoCH,SAAW,OAEtED,MAAMK,oBAIdX,EAAE,gBAAgBK,GAAG,SAAS,SAASC,WAC/BM,SAAWZ,EAAEQ,MAAMC,KAAK,QACTC,QAAQ,kCAAoCE,SAAW,OAEtEN,MAAMK,oBAIdX,EAAE,cAAcK,GAAG,SAAS,SAASC,WAC7BO,WAAab,EAAEQ,MAAMC,KAAK,UACXC,QAAQ,oCAAsCG,WAAa,OAE1EP,MAAMK,oBAIdX,EAAE,oBAAoBK,GAAG,SAAS,SAASC,WACnCQ,UAAYd,EAAEQ,MAAMC,KAAK,aACzBM,OAASf,EAAEQ,MAAMC,KAAK,UACtBO,OAAShB,EAAEQ,MAAMC,KAAK,UAC1BT,EAAEiB,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,sDACrBZ,KAAM,CACFK,UAAWA,UACXE,OAAQA,OACRD,OAAQA,QAEZO,SAAU,OACVC,QAAS,SAASC,cACVC,OAASC,KAAKC,MAAMD,KAAKE,UAAUJ,cACnCC,OAAOI,OAAS,EAAG,KACfpB,KAAO,CACPgB,OAAQA,OAAOK,KAAI,SAASC,aACjB,CACHb,IAAKa,MAAMC,IACXC,KAAMF,MAAMG,YACZC,MAAOJ,MAAMI,WAKzBhC,UAAUiC,OAAO,2CAA4C3B,MACxD4B,MAAK,SAASC,cACXrC,aAAasC,OAAO,CACpBC,KAAMvC,aAAawC,MAAMC,QACzBC,KAAML,aACNH,MAAOhB,EAAEyB,KAAKC,WAAW,mBAAoB,+BAC9CC,MAAK,SAASC,OACbA,MAAMC,UAAU3C,GAAGH,YAAY+C,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAMK,OACNC,SAASjD,OACbJ,EAAE,eAAeK,GAAG,SAAS,SAASC,WAC9BgD,aAAetD,EAAEQ,MAAM+C,KAAK,gBAC5BC,YAAcxD,EAAEQ,MAAM+C,KAAK,eAC/BD,aAAaF,OACbI,YAAYJ,OACZK,YAAW,WACPH,aAAaI,SACd,KAEHL,SAASM,MAAM3D,EAAEQ,MAAM,OAE3BR,EAAE,eAAeK,GAAG,iBAAiB,WACjCL,EAAEQ,MAAM+C,KAAK,gBAAgBG,gBAKpCE,MAAK,WACFC,QAAQC,MAAM,6CAEf,KACCC,QAAU5C,EAAEyB,KAAKC,WAAW,kBAAmB,6BACnD5C,aAAasC,OAAO,CAChBC,KAAMvC,aAAawC,MAAMC,QACzBC,KAAMoB,UACPjB,MAAK,SAASC,OACbA,MAAMC,UAAU3C,GAAGH,YAAY+C,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAMK,iBAO1BpD,EAAE,oBAAoBK,GAAG,SAAS,SAASC,OACvCA,MAAMK,iBACNX,EAAEiB,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,0DACrBZ,KAAM,CACFK,UAAWd,EAAEQ,MAAMC,KAAK,aACxBO,OAAQhB,EAAEQ,MAAMC,KAAK,UACrBM,OAAQf,EAAEQ,MAAMC,KAAK,WAEzBa,SAAU,OACVC,QAAS,SAASC,cACVwC,YAActC,KAAKC,MAAMD,KAAKE,UAAUJ,kBACxCwC,YAAYzC,SACZ0C,OAAOC,KAAKF,YAAY9C,IAAK,WAW1B,GATIjB,aAAasC,OAAO,CACvBC,KAAMvC,aAAawC,MAAMC,QACzBC,KAAMqB,YAAYD,UACnBjB,MAAK,SAASC,cACbA,MAAMC,UAAU3C,GAAGH,YAAY+C,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAMK,OACC"}