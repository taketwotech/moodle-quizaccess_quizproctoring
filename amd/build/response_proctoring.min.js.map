{"version":3,"file":"response_proctoring.min.js","sources":["../src/response_proctoring.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript controller for the \"Grading\" panel at the right of the page\r\n *\r\n * @subpackage quizproctoring\r\n * @copyright  2020 Mahendra Soni <ms@taketwotechnologies.com> {@link https://taketwotechnologies.com}\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport Modal from 'core/modal';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\n//import ModalProctoring from './modal_proctoring';\r\n\r\n    var ResponsePanel = function(responses) {\r\n        this.responses = responses;\r\n        this.registerEventListeners();\r\n    };\r\n\r\n    ResponsePanel.prototype.qid = null;\r\n    ResponsePanel.prototype.rid = null;\r\n    ResponsePanel.prototype.sec = null;\r\n    ResponsePanel.prototype.courseid = null;\r\n    ResponsePanel.prototype.responses = Array();\r\n    ResponsePanel.prototype.index = 0;\r\n    ResponsePanel.prototype.quizid = 0;\r\n    ResponsePanel.prototype.attemptid = 0;\r\n    ResponsePanel.prototype.userid = 0;\r\n    ResponsePanel.prototype.currentpage = 1;\r\n    ResponsePanel.prototype.firstPage = 1;\r\n    ResponsePanel.prototype.lastPage = 0;\r\n    ResponsePanel.prototype.tempindex = 0;\r\n    ResponsePanel.prototype.prevpage = 0;\r\n    ResponsePanel.prototype.temarrayprev = Array();\r\n    ResponsePanel.prototype.temarraynext = Array();\r\n    /**\r\n     * Register event listeners for the grade panel.\r\n     *\r\n     * @method registerEventListeners\r\n     */\r\n    ResponsePanel.prototype.registerEventListeners = function() {\r\n       \r\n        var self = this; // Store reference to ResponsePanel instance\r\n\r\n    // Example assuming you have direct access to the buttons triggering 'next' and 'prev'\r\n    $(document).on('click', SELECTORS.PREVIOUS_BUTTON, function(e) {\r\n        $(document).trigger('prev');\r\n        e.preventDefault();\r\n    });\r\n\r\n    $(document).on('click', SELECTORS.NEXT_BUTTON, function(e) {\r\n        $(document).trigger('next');\r\n        e.preventDefault();\r\n    });\r\n\r\n    // Assuming you also want to handle 'next' and 'prev' events within ResponsePanel\r\n    $(document).on('next', function() {\r\n        self._getNextUser();\r\n    });\r\n\r\n    $(document).on('prev', function() {\r\n        self._getPreviousUser();\r\n    });\r\n};\r\n\r\n    var registered = false;\r\n        var SELECTORS = {\r\n            PREVIOUS_BUTTON: '[data-action=\"previous\"]',\r\n            NEXT_BUTTON: '[data-action=\"next\"]',\r\n        };\r\n\r\n    var ModalProctoring = function(root) {\r\n        Modal.call(this, root);\r\n        if (!this.getFooter().find(SELECTORS.PREVIOUS_BUTTON).length) {\r\n                 Notification.exception({message: 'No previous button found'});\r\n            }\r\n\r\n            if (!this.getFooter().find(SELECTORS.NEXT_BUTTON).length) {\r\n                Notification.exception({message: 'No next button found'});\r\n            }\r\n    };\r\n\r\n    /**\r\n     * Reset buttons method\r\n     */\r\n    ResponsePanel.prototype._reset = function() {\r\n        if (this.responses.length) {\r\n            var isFirst = this.index === 0;\r\n            var isLast = this.responses.length === this.index + 1;\r\n            if (isFirst) {\r\n                if (this.firstPage == this.currentpage) {\r\n                    $('[data-action=\"previous\"]').prop(\"disabled\", \"disabled\");\r\n                } else {\r\n                    $('[data-action=\"previous\"]').prop(\"disabled\", false);\r\n                }\r\n                $('[data-action=\"next\"]').prop(\"disabled\", false);\r\n            } else if (isLast) {\r\n                if (this.currentpage == this.lastpage) {\r\n                    $('[data-action=\"next\"]').prop(\"disabled\", \"disabled\");\r\n                } else {\r\n                    $('[data-action=\"next\"]').prop(\"disabled\", false);\r\n                }\r\n                $('[data-action=\"previous\"]').prop(\"disabled\", false);\r\n            } else {\r\n                $('[data-action=\"previous\"]').prop(\"disabled\", false);\r\n                $('[data-action=\"next\"]').prop(\"disabled\", false);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * First page settings\r\n     *\r\n     */\r\n     ResponsePanel.prototype._isFirstPage = function() {\r\n        var insidethid = this;\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n            data: {\r\n                attemptid: this.attemptid,\r\n                userid: this.userid,\r\n                quizid: this.quizid,\r\n                currentpage: (this.currentpage - 2)\r\n            },\r\n            dataType: 'json',\r\n            success: function(response) {\r\n                var images = JSON.parse(JSON.stringify(response));\r\n                insidethid.temarrayprev = images;\r\n                insidethid.prevpage = 1;\r\n            }\r\n        });\r\n     };\r\n\r\n     /**\r\n      * Last page settings\r\n      *\r\n      */\r\n    ResponsePanel.prototype._isLastPage = function() {\r\n        var insidethid = this;\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n            data: {\r\n                attemptid: this.attemptid,\r\n                userid: this.userid,\r\n                quizid: this.quizid,\r\n                currentpage: this.currentpage\r\n            },\r\n            dataType: 'json',\r\n            success: function(response) {\r\n                var images = JSON.parse(JSON.stringify(response));\r\n                insidethid.temarraynext = images;\r\n                if (images[0]) {\r\n                    insidethid.tempindex = 1;\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Get next user to process\r\n     *\r\n     * @method _getNextUser\r\n     */\r\n    ResponsePanel.prototype._getNextUser = function() {\r\n        if (this.tempindex) {\r\n            this.index = -1;\r\n            this.responses = this.temarraynext;\r\n            this.currentpage += 1;\r\n        }\r\n        this.tempindex = 0;\r\n        this.prevpage = 0;\r\n        this.index += 1;\r\n        this._reset();\r\n        var res = this.responses[this.index];\r\n        if (res) {\r\n            $(\".imgheading\").html(res.title);\r\n            $(\".userimg\").attr(\"src\", res.img);\r\n        }\r\n        var isFirst = this.index === 0;\r\n        if (isFirst) {\r\n            this._isFirstPage();\r\n        }\r\n        var isLast = this.responses.length === this.index + 1;\r\n        if (isLast) {\r\n            this._isLastPage();\r\n        }\r\n\r\n    };\r\n\r\n    /**\r\n     * Get previous user to process\r\n     *\r\n     * @method _getNextUser\r\n     */\r\n    ResponsePanel.prototype._getPreviousUser = function() {\r\n        if (this.tempindex) {\r\n            this.index = 18;\r\n        } else {\r\n            this.index -= 1;\r\n        }\r\n\r\n        if (this.prevpage) {\r\n            this.index = 19;\r\n            this.responses = this.temarrayprev;\r\n            this.currentpage -= 1;\r\n        }\r\n        this.prevpage = 0;\r\n        this.tempindex = 0;\r\n        this._reset();\r\n        var res = this.responses[this.index];\r\n        if (res) {\r\n            $(\".imgheading\").html(res.title);\r\n            $(\".userimg\").attr(\"src\", res.img);\r\n        }\r\n        var isFirst = this.index === 0;\r\n        if (isFirst) {\r\n            this._isFirstPage();\r\n        }\r\n\r\n        var isLast = this.responses.length === this.index + 1;\r\n        if (isLast) {\r\n            this._isLastPage();\r\n        }\r\n\r\n    };\r\n\r\nexport default class ModalAddProctoringImage extends Modal {\r\n    static TYPE = 'quizaccess_quizproctoring-response';\r\n    static TEMPLATE = 'quizaccess_quizproctoring/response_modal';\r\n\r\n\r\n    /**\r\n     * Create the add random question modal.\r\n     *\r\n     * @param  {Number} attemptid Current attempt id.\r\n     * @param  {Number} quizid quiz id.\r\n     * @param  {Number} userid User Id.\r\n     * @param  {boolean} useridentity user Identity.\r\n     * @param  {boolean} proctoringimageshow proctoring Image Show.\r\n     */\r\n    static init(attemptid = null, quizid = null, userid = null, useridentity = null, $proctoringimageshow) {\r\n        var docElement = $(document);\r\n        docElement.ready(function() {\r\n            if ($proctoringimageshow == 1) {\r\n                let btn = document.createElement(\"button\");\r\n                btn.innerHTML = M.util.get_string('proctoringimages', 'quizaccess_quizproctoring');\r\n                btn.setAttribute(\"type\", \"button\");\r\n                btn.setAttribute(\"value\", \"proctoringimage\");\r\n                btn.setAttribute(\"class\", \"proctoringimage btn btn-primary\");\r\n                btn.setAttribute(\"data-attemptid\", attemptid);\r\n                btn.setAttribute(\"data-quizid\", quizid);\r\n                btn.setAttribute(\"data-userid\", userid);\r\n                document.getElementById(\"page-content\").prepend(btn);\r\n            }\r\n            if (useridentity && useridentity != 0) {\r\n                let btnidentity = document.createElement(\"button\");\r\n                btnidentity.innerHTML = M.util.get_string('proctoringidentity', 'quizaccess_quizproctoring');\r\n                btnidentity.setAttribute(\"type\", \"button\");\r\n                btnidentity.setAttribute(\"value\", \"proctoridentity\");\r\n                btnidentity.setAttribute(\"class\", \"proctoridentity btn btn-primary\");\r\n                btnidentity.setAttribute(\"data-attemptid\", attemptid);\r\n                btnidentity.setAttribute(\"data-quizid\", quizid);\r\n                btnidentity.setAttribute(\"data-userid\", userid);\r\n                document.getElementById(\"page-content\").prepend(btnidentity);\r\n            }\r\n        });\r\n\r\n        docElement.on('click', 'button.proctoringimage', function(e) {\r\n            e.preventDefault();\r\n            var quizid = $(this).data('quizid');\r\n            var userid = $(this).data('userid');\r\n            var attemptid = $(this).data('attemptid');\r\n            $.ajax({\r\n                url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n                data: {\r\n                    attemptid: $(this).data('attemptid'),\r\n                    userid: $(this).data('userid'),\r\n                    quizid: $(this).data('quizid')\r\n                },\r\n                dataType: 'json',\r\n                success: function(response) {\r\n                    console.log(response);\r\n                    var images = JSON.parse(JSON.stringify(response));\r\n                    if (images.length > 0) {\r\n                        var rp = new ResponsePanel(images);\r\n                        rp.quizid = quizid;\r\n                        rp.userid = userid;\r\n                        rp.attemptid = attemptid;\r\n                        rp.lastpage = rp.responses[rp.index].totalpage;console.log(rp.responses[rp.index]);\r\n                        return ModalAddProctoringImage.create({\r\n                            type: ModalAddProctoringImage.TYPE,\r\n                        }).then(function(modal) {\r\n                            modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                            modal.setTitle('User Images');\r\n                            modal.show();\r\n                            $(\".imgheading\").html(rp.responses[rp.index].title);\r\n                            $(\".userimg\").attr(\"src\", rp.responses[rp.index].img);\r\n                            if (rp.responses[rp.index].total == 1) {\r\n                                $('[data-action=\"next\"]').prop(\"disabled\", \"disabled\");\r\n                            }\r\n                            return null;\r\n                        });\r\n                    } else {\r\n                        var message = M.util.get_string('noimageswarning', 'quizaccess_quizproctoring');\r\n                        return ModalFactory.create({\r\n                            type: ModalFactory.types.DEFAULT,\r\n                            body: message,\r\n                        }).then(function(modal) {\r\n                            modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                            modal.show();\r\n                            return null;\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nModalAddProctoringImage.registerModalType();\r\n"],"names":["ResponsePanel","responses","registerEventListeners","prototype","qid","rid","sec","courseid","Array","index","quizid","attemptid","userid","currentpage","firstPage","lastPage","tempindex","prevpage","temarrayprev","temarraynext","self","this","document","on","SELECTORS","PREVIOUS_BUTTON","e","trigger","preventDefault","NEXT_BUTTON","_getNextUser","_getPreviousUser","_reset","length","isFirst","isLast","prop","lastpage","_isFirstPage","insidethid","ajax","url","M","cfg","wwwroot","data","dataType","success","response","images","JSON","parse","stringify","_isLastPage","res","html","title","attr","img","ModalAddProctoringImage","Modal","useridentity","$proctoringimageshow","docElement","ready","btn","createElement","innerHTML","util","get_string","setAttribute","getElementById","prepend","btnidentity","console","log","rp","totalpage","create","type","TYPE","then","modal","getRoot","ModalEvents","hidden","destroy","bind","setTitle","show","total","message","ModalFactory","types","DEFAULT","body","registerModalType"],"mappings":"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"}