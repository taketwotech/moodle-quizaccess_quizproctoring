/**
 * Javascript controller for the "Grading" panel at the right of the page
 *
 * @subpackage quizproctoring
 * @copyright  2020 Mahendra Soni <ms@taketwotechnologies.com> {@link https://taketwotechnologies.com}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("quizaccess_quizproctoring/response_panel",["jquery","core/modal_factory","core/modal_events","core/templates"],(function($,ModalFactory,ModalEvents,Templates){return{init:function(){let attemptid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,quizid=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,userid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,useridentity=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,proctoringimageshow=arguments.length>4?arguments[4]:void 0;var docElement=$(document);docElement.ready((function(){if(1==proctoringimageshow){let btn=document.createElement("button");btn.innerHTML=M.util.get_string("proctoringimages","quizaccess_quizproctoring"),btn.setAttribute("type","button"),btn.setAttribute("value","proctoringimage"),btn.setAttribute("class","proctoringimage btn btn-primary"),btn.setAttribute("data-attemptid",attemptid),btn.setAttribute("data-quizid",quizid),btn.setAttribute("data-userid",userid),document.getElementById("page-content").prepend(btn)}if(useridentity&&0!=useridentity){let btnidentity=document.createElement("button");btnidentity.innerHTML=M.util.get_string("proctoringidentity","quizaccess_quizproctoring"),btnidentity.setAttribute("type","button"),btnidentity.setAttribute("value","proctoridentity"),btnidentity.setAttribute("class","proctoridentity btn btn-primary"),btnidentity.setAttribute("data-attemptid",attemptid),btnidentity.setAttribute("data-quizid",quizid),btnidentity.setAttribute("data-userid",userid),document.getElementById("page-content").prepend(btnidentity)}})),docElement.on("click","button.proctoringimage",(function(e){e.preventDefault();var quizid=$(this).data("quizid"),userid=$(this).data("userid"),attemptid=$(this).data("attemptid");$.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/ajax_report.php",data:{attemptid:attemptid,userid:userid,quizid:quizid},dataType:"json",success:function(response){var images=JSON.parse(JSON.stringify(response));if(images.length>0){var data={images:images.map((function(image){return{url:image.img,title:image.title}}))};Templates.render("quizaccess_quizproctoring/response_modal",data).done((function(renderedHtml){ModalFactory.create({type:ModalFactory.types.DEFAULT,body:renderedHtml,title:M.util.get_string("proctoringimages","quizaccess_quizproctoring")}).then((function(modal){modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.show(),lightbox.init(),$(".image-link").on("click",(function(event){var titleElement=$(this).next(".image-title");titleElement.show(),setTimeout((function(){titleElement.hide()}),1e3),lightbox.start($(this)[0])})),$(".image-link").on("lightbox:open",(function(){$(this).next(".image-title").hide()}))}))})).fail((function(){console.error("Failed to render Mustache template")}))}else{var message=M.util.get_string("noimageswarning","quizaccess_quizproctoring");ModalFactory.create({type:ModalFactory.types.DEFAULT,body:message}).then((function(modal){modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.show()}))}}})})),docElement.on("click","button.proctoridentity",(function(e){e.preventDefault(),$.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/proctoridentity.php",data:{attemptid:$(this).data("attemptid"),userid:$(this).data("userid"),quizid:$(this).data("quizid")},dataType:"json",success:function(response){var residentity=JSON.parse(JSON.stringify(response));return residentity.success?(window.open(residentity.url,"_blank"),!0):ModalFactory.create({type:ModalFactory.types.DEFAULT,body:residentity.message}).then((function(modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.show(),null}))}})}))}}}));

//# sourceMappingURL=response_panel.min.js.map