define("quizaccess_quizproctoring/report",["jquery","core/modal_factory","core/modal_events","core/templates","core/str","core/notification"],(function($,ModalFactory,ModalEvents,Templates,str,notification){return{init:function(){$(document).ready((function(){"undefined"!=typeof lightbox&&lightbox.init()})),$(".delete-icon").on("click",(function(event){event.preventDefault();var username=$(this).data("username"),cmid=$(this).data("cmid"),quizid=$(this).data("quizid"),userid=$(this).data("userid"),newUrl=M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/proctoringreport.php?delete="+userid+"&cmid="+cmid+"&quizid="+quizid;Promise.all([str.get_string("deleteallimagesuser","quizaccess_quizproctoring",username),str.get_string("confirmation","quizaccess_quizproctoring"),str.get_string("deleteallimages","quizaccess_quizproctoring"),str.get_string("delete","moodle"),str.get_string("cancel","moodle")]).then((function(strings){var message=strings[0],title=strings[1],checkboxtext=strings[2],deleteLabel=strings[3],cancelLabel=strings[4],checkboxHtml='<div><input type="checkbox" id="deleteallimages" /><label class="deleteall">'+checkboxtext+"</label></div>";notification.confirm(title,message+checkboxHtml,deleteLabel,cancelLabel,(function(){$("#deleteallimages").is(":checked")&&(newUrl+="&all=true",window.location.href=newUrl)}),(function(){})),setTimeout((function(){$(".modal-footer").addClass("deletenotifbtn");var deleteButton=$('.modal-footer button[data-action="save"]');deleteButton.prop("disabled",!0),$(document).off("change","#deleteallimages").on("change","#deleteallimages",(function(){deleteButton.prop("disabled",!$(this).is(":checked"))}))}),300)})).catch((function(){}))})),$(".delete-quiz").on("click",(function(event){event.preventDefault();var quizname=$(this).data("quiz"),cmid=$(this).data("cmid"),quizid=$(this).data("quizid"),newUrl=M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/imagesreport.php?cmid="+cmid+"&delete="+quizid;Promise.all([str.get_string("deleteallimagesquiz","quizaccess_quizproctoring",quizname),str.get_string("confirmation","quizaccess_quizproctoring"),str.get_string("deleteallimages","quizaccess_quizproctoring"),str.get_string("delete","moodle"),str.get_string("cancel","moodle")]).then((function(strings){var message=strings[0],title=strings[1],checkboxtext=strings[2],deleteLabel=strings[3],cancelLabel=strings[4],checkboxHtml='<div><input type="checkbox" id="deleteallimage" /><label class="deleteall">'+checkboxtext+"</label></div>";notification.confirm(title,message+checkboxHtml,deleteLabel,cancelLabel,(function(){$("#deleteallimage").is(":checked")&&(newUrl+="&all=true",window.location.href=newUrl)}),(function(){})),setTimeout((function(){$(".modal-footer").addClass("deletenotifbtn");var deleteButton=$('.modal-footer button[data-action="save"]');deleteButton.prop("disabled",!0),$(document).off("change","#deleteallimage").on("change","#deleteallimage",(function(){deleteButton.prop("disabled",!$(this).is(":checked"))}))}),300)})).catch((function(){}))})),$(".delcourse").on("click",(function(event){event.preventDefault();var coursename=$(this).data("course"),cmid=$(this).data("cmid"),courseid=$(this).data("courseid"),newUrl=M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/imagesreport.php?cmid="+cmid+"&delcourse="+courseid;Promise.all([str.get_string("deleteallimagescourse","quizaccess_quizproctoring",coursename),str.get_string("confirmation","quizaccess_quizproctoring"),str.get_string("deleteallimages","quizaccess_quizproctoring"),str.get_string("delete","moodle"),str.get_string("cancel","moodle")]).then((function(strings){var message=strings[0],title=strings[1],checkboxtext=strings[2],deleteLabel=strings[3],cancelLabel=strings[4],checkboxHtml='<div><input type="checkbox" id="deleteallimag" /><label class="deleteall">'+checkboxtext+"</label></div>";notification.confirm(title,message+checkboxHtml,deleteLabel,cancelLabel,(function(){$("#deleteallimag").is(":checked")&&(newUrl+="&all=true",window.location.href=newUrl)}),(function(){})),setTimeout((function(){$(".modal-footer").addClass("deletenotifbtn");var deleteButton=$('.modal-footer button[data-action="save"]');deleteButton.prop("disabled",!0),$(document).off("change","#deleteallimag").on("change","#deleteallimag",(function(){deleteButton.prop("disabled",!$(this).is(":checked"))}))}),300)})).catch((function(){}))})),$(".proctoringimage").on("click",(function(event){event.preventDefault();var attemptid=$(this).data("attemptid"),quizid=$(this).data("quizid"),userid=$(this).data("userid"),startdate=$(this).data("startdate"),all=$("#storeallimages").is(":checked")?"true":"false",modaltitle="true"===all?M.util.get_string("allimages","quizaccess_quizproctoring"):M.util.get_string("proctoringimages","quizaccess_quizproctoring");ModalFactory.create({type:ModalFactory.types.DEFAULT,body:'<div class="image-content"><p>Loading images...</p></div><div class="pagination-controls"></div>',title:modaltitle,large:!0}).then((function(modal){modal.show();var currentPage=1,totalPages=1;function loadImages(page){$.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/ajax_report.php",data:{attemptid:attemptid,userid:userid,quizid:quizid,all:all,page:page,perpage:35},dataType:"json",success:function(response){var images=response.images.map((function(image){return{url:image.img,title:image.title,time:image.timecreated,cssClass:getCssClass(image.imagestatus)}}));totalPages=response.totalPages;var data={attemptdate:startdate,images:images,currentPage:response.currentPage,totalPages:response.totalPages,isFirstPage:1===response.currentPage,isLastPage:response.currentPage===response.totalPages,str:function(key){return M.util.get_string(key,"quizaccess_quizproctoring")}};modal.getBody().find(".image-content").html(""),Templates.render("quizaccess_quizproctoring/response_modal",data).done((function(renderedHtml){modal.getBody().find(".image-content").html(renderedHtml),lightbox.init(),$(".image-link").on("click",(function(){var titleElement=$(this).next(".image-title"),timeElement=$(this).next(".image-time");titleElement.show(),timeElement.show(),lightbox.start($(this))})),$(".image-link").on("lightbox:open",(function(){$(this).next(".image-title").hide()})),images.length>0?modal.getBody().find(".pagination-controls").html(function(currentPage,totalPages){return'<div><button class="prev-page" '+(1===currentPage?"disabled":"")+">Previous</button> Page "+currentPage+" of "+totalPages+' <button class="next-page" '+(currentPage===totalPages?"disabled":"")+">Next</button></div>"}(response.currentPage,response.totalPages)):modal.getBody().find(".pagination-controls").html("")}))},error:function(jqXHR,textStatus){modal.getBody().find(".image-content").html("<p>Error loading images: "+textStatus+"</p>")}})}function getCssClass(status){switch(status.toLowerCase()){case"main image":return"main-image";case"warning":return"warning-image";default:return"green-image"}}modal.getBody().off("click",".prev-page").on("click",".prev-page",(function(){currentPage>1&&loadImages(--currentPage)})),modal.getBody().off("click",".next-page").on("click",".next-page",(function(){currentPage<totalPages&&loadImages(++currentPage)})),loadImages(currentPage);let escapePressed=!1;$(document).on("keydown",(function(event){"Escape"!==event.key||escapePressed||(escapePressed=!0,"block"===$(".lb-container").css("display")&&lightbox.end(),void 0!==modal&&modal.isVisible()&&modal.hide(),setTimeout((()=>{escapePressed=!1}),50),event.stopPropagation())}))})).catch((function(){}))})),$(".proctoridentity").on("click",(function(event){event.preventDefault(),$.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/proctoridentity.php",data:{attemptid:$(this).data("attemptid"),userid:$(this).data("userid"),quizid:$(this).data("quizid")},dataType:"json",success:function(response){var residentity=JSON.parse(JSON.stringify(response));return residentity.success?(window.open(residentity.url,"_blank"),!0):ModalFactory.create({type:ModalFactory.types.DEFAULT,body:residentity.message}).then((function(modal){return modal.getRoot().on(ModalEvents.hidden,modal.destroy.bind(modal)),modal.show(),null}))}})}))}}}));

//# sourceMappingURL=report.min.js.map