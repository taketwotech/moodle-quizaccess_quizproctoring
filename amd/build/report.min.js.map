{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["define(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates'],\r\nfunction($, ModalFactory, ModalEvents, Templates) {\r\n    return {\r\n        init: function() {\r\n            $(document).ready(function() {\r\n                if (typeof lightbox !== 'undefined') {\r\n                    lightbox.init();\r\n                }\r\n            });\r\n\r\n            $('.delete-icon').on('click', function(event) {\r\n                var username = $(this).data('username');\r\n                var confirmation = confirm('Delete all the Images of user \"' + username + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.delete-quiz').on('click', function(event) {\r\n                var quizname = $(this).data('quiz');\r\n                var confirmation = confirm('Delete all the Images of quiz \"' + quizname + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.delcourse').on('click', function(event) {\r\n                var coursename = $(this).data('course');\r\n                var confirmation = confirm('Delete all the Images of course \"' + coursename + '\"?');\r\n                if (!confirmation) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n\r\n            $('.proctoringimage').on('click', function(event) {\r\n                event.preventDefault();\r\n                var attemptid = $(this).data('attemptid');\r\n                var quizid = $(this).data('quizid');\r\n                var userid = $(this).data('userid');\r\n                var all = $(this).data('all');\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n                    data: {\r\n                        attemptid: attemptid,\r\n                        userid: userid,\r\n                        quizid: quizid,\r\n                        all: all\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var images = JSON.parse(JSON.stringify(response));\r\n                        if (images.length > 0) {\r\n                            var data = {\r\n                                images: images.map(function(image) {\r\n                                    return {\r\n                                        url: image.img,\r\n                                        time: image.timecreated,\r\n                                        title: image.title\r\n                                    };\r\n                                })\r\n                            };\r\n\r\n                            Templates.render('quizaccess_quizproctoring/response_modal', data)\r\n                                .done(function(renderedHtml) {\r\n                                    var modaltitle = all ? M.util.get_string('allimages', 'quizaccess_quizproctoring') :\r\n                                    M.util.get_string('proctoringimages', 'quizaccess_quizproctoring');\r\n                                    ModalFactory.create({\r\n                                    type: ModalFactory.types.DEFAULT,\r\n                                    body: renderedHtml,\r\n                                    title: modaltitle\r\n                                }).then(function(modal) {\r\n                                    modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                    modal.show();\r\n                                    lightbox.init();\r\n                                    $('.image-link').on('click', function() {\r\n                                        var titleElement = $(this).next('.image-title');\r\n                                        var timeElement = $(this).next('.image-time');\r\n                                        titleElement.show();\r\n                                        timeElement.show();                                        \r\n                                        lightbox.start($(this)[0]);\r\n                                    });\r\n                                    $('.image-link').on('lightbox:open', function() {\r\n                                        $(this).next('.image-title').hide();\r\n                                    });\r\n                                });\r\n                            });\r\n                        } else {\r\n                            var message = M.util.get_string('noimageswarning', 'quizaccess_quizproctoring');\r\n                            ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: message\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            $('.proctoridentity').on('click', function(event) {\r\n                event.preventDefault();\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoridentity.php',\r\n                    data: {\r\n                        attemptid: $(this).data('attemptid'),\r\n                        userid: $(this).data('userid'),\r\n                        quizid: $(this).data('quizid')\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var residentity = JSON.parse(JSON.stringify(response));\r\n                        if (residentity.success) {\r\n                            window.open(residentity.url, \"_blank\");\r\n                        } else {\r\n                            return ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: residentity.message,\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                                return null;\r\n                            });\r\n                        }\r\n                        return true;\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","init","document","ready","lightbox","on","event","username","this","data","confirm","preventDefault","quizname","coursename","attemptid","quizid","userid","all","ajax","url","M","cfg","wwwroot","dataType","success","response","images","JSON","parse","stringify","length","map","image","img","time","timecreated","title","render","done","renderedHtml","modaltitle","util","get_string","create","type","types","DEFAULT","body","then","modal","getRoot","hidden","destroy","bind","show","titleElement","next","timeElement","start","hide","message","residentity","window","open"],"mappings":"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"}