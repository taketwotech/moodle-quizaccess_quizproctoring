{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["define(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates', 'core/str', 'core/notification'],\r\nfunction($, ModalFactory, ModalEvents, Templates, str, notification) {\r\n    return {\r\n        init: function() {\r\n            $(document).ready(function() {\r\n                if (typeof lightbox !== 'undefined') {\r\n                    lightbox.init();\r\n                }\r\n                $('.delcourse').show();\r\n                $('.delete-icon').show();\r\n                $('.delete-quiz').show();\r\n            });\r\n            $('.delete-icon').on('click', function(event) {\r\n                event.preventDefault();\r\n                var username = $(this).data('username');\r\n                var cmid = $(this).data('cmid');\r\n                var quizid = $(this).data('quizid');\r\n                var userid = $(this).data('userid');\r\n                var newUrl = M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoringreport.php?delete='\r\n                + userid + '&cmid=' + cmid + '&quizid=' + quizid;\r\n                Promise.all([\r\n                    str.get_string('deleteallimagesuser', 'quizaccess_quizproctoring', username),\r\n                    str.get_string('confirmation', 'quizaccess_quizproctoring'),\r\n                    str.get_string('deleteallimages', 'quizaccess_quizproctoring'),\r\n                    str.get_string('delete', 'moodle'),\r\n                    str.get_string('cancel', 'moodle')\r\n                ]).then(function(strings) {\r\n                    var message = strings[0];\r\n                    var title = strings[1];\r\n                    var checkboxtext = strings[2];\r\n                    var deleteLabel = strings[3];\r\n                    var cancelLabel = strings[4];\r\n                    var checkboxHtml = '<div><input type=\"checkbox\" id=\"deleteallimages\" /><label class=\"deleteall\">'\r\n                    + checkboxtext + '</label></div>';\r\n                    notification.confirm(\r\n                        title,\r\n                        message + checkboxHtml,\r\n                        deleteLabel,\r\n                        cancelLabel,\r\n                        function() {\r\n                            var allImages = $('#deleteallimages').is(':checked');\r\n                            if (allImages) {\r\n                                newUrl += '&all=true';\r\n                            }\r\n                            window.location.href = newUrl;\r\n                        },\r\n                        function() {\r\n                            // Do nothing on 'Cancel'\r\n                        }\r\n                    );\r\n                });\r\n            });\r\n\r\n            $('.delete-quiz').on('click', function(event) {\r\n                event.preventDefault();\r\n                var quizname = $(this).data('quiz');\r\n                var cmid = $(this).data('cmid');\r\n                var quizid = $(this).data('quizid');\r\n                var newUrl = M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/imagesreport.php?cmid='\r\n                + cmid + '&delete=' + quizid;\r\n                Promise.all([\r\n                    str.get_string('deleteallimagesquiz', 'quizaccess_quizproctoring', quizname),\r\n                    str.get_string('confirmation', 'quizaccess_quizproctoring'),\r\n                    str.get_string('deleteallimages', 'quizaccess_quizproctoring'),\r\n                    str.get_string('delete', 'moodle'),\r\n                    str.get_string('cancel', 'moodle')\r\n                ]).then(function(strings) {\r\n                    var message = strings[0];\r\n                    var title = strings[1];\r\n                    var checkboxtext = strings[2];\r\n                    var deleteLabel = strings[3];\r\n                    var cancelLabel = strings[4];\r\n                    var checkboxHtml = '<div><input type=\"checkbox\" id=\"deleteallimages\" /><label class=\"deleteall\">'\r\n                    + checkboxtext + '</label></div>';\r\n                    notification.confirm(\r\n                        title,\r\n                        message + checkboxHtml,\r\n                        deleteLabel,\r\n                        cancelLabel,\r\n                        function() {\r\n                            var allImages = $('#deleteallimages').is(':checked');\r\n                            if (allImages) {\r\n                                newUrl += '&all=true';\r\n                            }\r\n                            window.location.href = newUrl;\r\n                        },\r\n                        function() {\r\n                            // Do nothing on 'Cancel'\r\n                        }\r\n                    );\r\n                });\r\n            });\r\n\r\n            $('.delcourse').on('click', function(event) {\r\n                event.preventDefault();\r\n                var coursename = $(this).data('course');\r\n                var cmid = $(this).data('cmid');\r\n                var courseid = $(this).data('courseid');\r\n                var newUrl = M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/imagesreport.php?cmid='\r\n                + cmid + '&delcourse=' + courseid;\r\n                Promise.all([\r\n                    str.get_string('deleteallimagescourse', 'quizaccess_quizproctoring', coursename),\r\n                    str.get_string('confirmation', 'quizaccess_quizproctoring'),\r\n                    str.get_string('deleteallimages', 'quizaccess_quizproctoring'),\r\n                    str.get_string('delete', 'moodle'),\r\n                    str.get_string('cancel', 'moodle')\r\n                ]).then(function(strings) {\r\n                    var message = strings[0];\r\n                    var title = strings[1];\r\n                    var checkboxtext = strings[2];\r\n                    var deleteLabel = strings[3];\r\n                    var cancelLabel = strings[4];\r\n                    var checkboxHtml = '<div><input type=\"checkbox\" id=\"deleteallimages\" /><label class=\"deleteall\">'\r\n                    + checkboxtext + '</label></div>';\r\n                    notification.confirm(\r\n                        title,\r\n                        message + checkboxHtml,\r\n                        deleteLabel,\r\n                        cancelLabel,\r\n                        function() {\r\n                            var allImages = $('#deleteallimages').is(':checked');\r\n                            if (allImages) {\r\n                                newUrl += '&all=true';\r\n                            }\r\n                            window.location.href = newUrl;\r\n                        },\r\n                        function() {\r\n                            // Do nothing on 'Cancel'\r\n                        }\r\n                    );\r\n                });\r\n            });\r\n\r\n            $('.proctoringimage').on('click', function(event) {\r\n                event.preventDefault();\r\n                var attemptid = $(this).data('attemptid');\r\n                var quizid = $(this).data('quizid');\r\n                var userid = $(this).data('userid');\r\n                var all = $(this).data('all');\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n                    data: {\r\n                        attemptid: attemptid,\r\n                        userid: userid,\r\n                        quizid: quizid,\r\n                        all: all\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var images = JSON.parse(JSON.stringify(response));\r\n                        if (images.length > 0) {\r\n                            var data = {\r\n                                images: images.map(function(image) {\r\n                                    return {\r\n                                        url: image.img,\r\n                                        time: image.timecreated,\r\n                                        title: image.title\r\n                                    };\r\n                                })\r\n                            };\r\n\r\n                            Templates.render('quizaccess_quizproctoring/response_modal', data)\r\n                                .done(function(renderedHtml) {\r\n                                    var modaltitle = all ? M.util.get_string('allimages', 'quizaccess_quizproctoring') :\r\n                                    M.util.get_string('proctoringimages', 'quizaccess_quizproctoring');\r\n                                    ModalFactory.create({\r\n                                    type: ModalFactory.types.DEFAULT,\r\n                                    body: renderedHtml,\r\n                                    title: modaltitle\r\n                                }).then(function(modal) {\r\n                                    modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                    modal.show();\r\n                                    lightbox.init();\r\n                                    $('.image-link').on('click', function() {\r\n                                        var titleElement = $(this).next('.image-title');\r\n                                        var timeElement = $(this).next('.image-time');\r\n                                        titleElement.show();\r\n                                        timeElement.show();\r\n                                        lightbox.start($(this)[0]);\r\n                                    });\r\n                                    $('.image-link').on('lightbox:open', function() {\r\n                                        $(this).next('.image-title').hide();\r\n                                    });\r\n                                });\r\n                            });\r\n                        } else {\r\n                            var message = M.util.get_string('noimageswarning', 'quizaccess_quizproctoring');\r\n                            ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: message\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            $('.proctoridentity').on('click', function(event) {\r\n                event.preventDefault();\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoridentity.php',\r\n                    data: {\r\n                        attemptid: $(this).data('attemptid'),\r\n                        userid: $(this).data('userid'),\r\n                        quizid: $(this).data('quizid')\r\n                    },\r\n                    dataType: 'json',\r\n                    success: function(response) {\r\n                        var residentity = JSON.parse(JSON.stringify(response));\r\n                        if (residentity.success) {\r\n                            window.open(residentity.url, \"_blank\");\r\n                        } else {\r\n                            return ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: residentity.message,\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                                return null;\r\n                            });\r\n                        }\r\n                        return true;\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","str","notification","init","document","ready","lightbox","show","on","event","preventDefault","username","this","data","cmid","quizid","userid","newUrl","M","cfg","wwwroot","Promise","all","get_string","then","strings","message","title","checkboxtext","deleteLabel","cancelLabel","checkboxHtml","confirm","is","window","location","href","quizname","coursename","courseid","attemptid","ajax","url","dataType","success","response","images","JSON","parse","stringify","length","map","image","img","time","timecreated","render","done","renderedHtml","modaltitle","util","create","type","types","DEFAULT","body","modal","getRoot","hidden","destroy","bind","titleElement","next","timeElement","start","hide","residentity","open"],"mappings":"AAAAA,0CAAO,CAAC,SAAU,qBAAsB,oBAAqB,iBAAkB,WAAY,sBAC3F,SAASC,EAAGC,aAAcC,YAAaC,UAAWC,IAAKC,oBAC5C,CACHC,KAAM,WACFN,EAAEO,UAAUC,OAAM,WACU,oBAAbC,UACPA,SAASH,OAEbN,EAAE,cAAcU,OAChBV,EAAE,gBAAgBU,OAClBV,EAAE,gBAAgBU,UAEtBV,EAAE,gBAAgBW,GAAG,SAAS,SAASC,OACnCA,MAAMC,qBACFC,SAAWd,EAAEe,MAAMC,KAAK,YACxBC,KAAOjB,EAAEe,MAAMC,KAAK,QACpBE,OAASlB,EAAEe,MAAMC,KAAK,UACtBG,OAASnB,EAAEe,MAAMC,KAAK,UACtBI,OAASC,EAAEC,IAAIC,QAAU,mEAC3BJ,OAAS,SAAWF,KAAO,WAAaC,OAC1CM,QAAQC,IAAI,CACRrB,IAAIsB,WAAW,sBAAuB,4BAA6BZ,UACnEV,IAAIsB,WAAW,eAAgB,6BAC/BtB,IAAIsB,WAAW,kBAAmB,6BAClCtB,IAAIsB,WAAW,SAAU,UACzBtB,IAAIsB,WAAW,SAAU,YAC1BC,MAAK,SAASC,aACTC,QAAUD,QAAQ,GAClBE,MAAQF,QAAQ,GAChBG,aAAeH,QAAQ,GACvBI,YAAcJ,QAAQ,GACtBK,YAAcL,QAAQ,GACtBM,aAAe,+EACjBH,aAAe,iBACjB1B,aAAa8B,QACTL,MACAD,QAAUK,aACVF,YACAC,aACA,WACoBjC,EAAE,oBAAoBoC,GAAG,cAErChB,QAAU,aAEdiB,OAAOC,SAASC,KAAOnB,UAE3B,qBAOZpB,EAAE,gBAAgBW,GAAG,SAAS,SAASC,OACnCA,MAAMC,qBACF2B,SAAWxC,EAAEe,MAAMC,KAAK,QACxBC,KAAOjB,EAAEe,MAAMC,KAAK,QACpBE,OAASlB,EAAEe,MAAMC,KAAK,UACtBI,OAASC,EAAEC,IAAIC,QAAU,6DAC3BN,KAAO,WAAaC,OACtBM,QAAQC,IAAI,CACRrB,IAAIsB,WAAW,sBAAuB,4BAA6Bc,UACnEpC,IAAIsB,WAAW,eAAgB,6BAC/BtB,IAAIsB,WAAW,kBAAmB,6BAClCtB,IAAIsB,WAAW,SAAU,UACzBtB,IAAIsB,WAAW,SAAU,YAC1BC,MAAK,SAASC,aACTC,QAAUD,QAAQ,GAClBE,MAAQF,QAAQ,GAChBG,aAAeH,QAAQ,GACvBI,YAAcJ,QAAQ,GACtBK,YAAcL,QAAQ,GACtBM,aAAe,+EACjBH,aAAe,iBACjB1B,aAAa8B,QACTL,MACAD,QAAUK,aACVF,YACAC,aACA,WACoBjC,EAAE,oBAAoBoC,GAAG,cAErChB,QAAU,aAEdiB,OAAOC,SAASC,KAAOnB,UAE3B,qBAOZpB,EAAE,cAAcW,GAAG,SAAS,SAASC,OACjCA,MAAMC,qBACF4B,WAAazC,EAAEe,MAAMC,KAAK,UAC1BC,KAAOjB,EAAEe,MAAMC,KAAK,QACpB0B,SAAW1C,EAAEe,MAAMC,KAAK,YACxBI,OAASC,EAAEC,IAAIC,QAAU,6DAC3BN,KAAO,cAAgByB,SACzBlB,QAAQC,IAAI,CACRrB,IAAIsB,WAAW,wBAAyB,4BAA6Be,YACrErC,IAAIsB,WAAW,eAAgB,6BAC/BtB,IAAIsB,WAAW,kBAAmB,6BAClCtB,IAAIsB,WAAW,SAAU,UACzBtB,IAAIsB,WAAW,SAAU,YAC1BC,MAAK,SAASC,aACTC,QAAUD,QAAQ,GAClBE,MAAQF,QAAQ,GAChBG,aAAeH,QAAQ,GACvBI,YAAcJ,QAAQ,GACtBK,YAAcL,QAAQ,GACtBM,aAAe,+EACjBH,aAAe,iBACjB1B,aAAa8B,QACTL,MACAD,QAAUK,aACVF,YACAC,aACA,WACoBjC,EAAE,oBAAoBoC,GAAG,cAErChB,QAAU,aAEdiB,OAAOC,SAASC,KAAOnB,UAE3B,qBAOZpB,EAAE,oBAAoBW,GAAG,SAAS,SAASC,OACvCA,MAAMC,qBACF8B,UAAY3C,EAAEe,MAAMC,KAAK,aACzBE,OAASlB,EAAEe,MAAMC,KAAK,UACtBG,OAASnB,EAAEe,MAAMC,KAAK,UACtBS,IAAMzB,EAAEe,MAAMC,KAAK,OACvBhB,EAAE4C,KAAK,CACHC,IAAKxB,EAAEC,IAAIC,QAAU,sDACrBP,KAAM,CACF2B,UAAWA,UACXxB,OAAQA,OACRD,OAAQA,OACRO,IAAKA,KAETqB,SAAU,OACVC,QAAS,SAASC,cACVC,OAASC,KAAKC,MAAMD,KAAKE,UAAUJ,cACnCC,OAAOI,OAAS,EAAG,KACfrC,KAAO,CACPiC,OAAQA,OAAOK,KAAI,SAASC,aACjB,CACHV,IAAKU,MAAMC,IACXC,KAAMF,MAAMG,YACZ5B,MAAOyB,MAAMzB,WAKzB3B,UAAUwD,OAAO,2CAA4C3C,MACxD4C,MAAK,SAASC,kBACPC,WAAarC,IAAMJ,EAAE0C,KAAKrC,WAAW,YAAa,6BACtDL,EAAE0C,KAAKrC,WAAW,mBAAoB,6BACtCzB,aAAa+D,OAAO,CACpBC,KAAMhE,aAAaiE,MAAMC,QACzBC,KAAMP,aACN/B,MAAOgC,aACRnC,MAAK,SAAS0C,OACbA,MAAMC,UAAU3D,GAAGT,YAAYqE,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAM3D,OACND,SAASH,OACTN,EAAE,eAAeW,GAAG,SAAS,eACrB+D,aAAe1E,EAAEe,MAAM4D,KAAK,gBAC5BC,YAAc5E,EAAEe,MAAM4D,KAAK,eAC/BD,aAAahE,OACbkE,YAAYlE,OACZD,SAASoE,MAAM7E,EAAEe,MAAM,OAE3Bf,EAAE,eAAeW,GAAG,iBAAiB,WACjCX,EAAEe,MAAM4D,KAAK,gBAAgBG,oBAItC,KACCjD,QAAUR,EAAE0C,KAAKrC,WAAW,kBAAmB,6BACnDzB,aAAa+D,OAAO,CAChBC,KAAMhE,aAAaiE,MAAMC,QACzBC,KAAMvC,UACPF,MAAK,SAAS0C,OACbA,MAAMC,UAAU3D,GAAGT,YAAYqE,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAM3D,iBAO1BV,EAAE,oBAAoBW,GAAG,SAAS,SAASC,OACvCA,MAAMC,iBACNb,EAAE4C,KAAK,CACHC,IAAKxB,EAAEC,IAAIC,QAAU,0DACrBP,KAAM,CACF2B,UAAW3C,EAAEe,MAAMC,KAAK,aACxBG,OAAQnB,EAAEe,MAAMC,KAAK,UACrBE,OAAQlB,EAAEe,MAAMC,KAAK,WAEzB8B,SAAU,OACVC,QAAS,SAASC,cACV+B,YAAc7B,KAAKC,MAAMD,KAAKE,UAAUJ,kBACxC+B,YAAYhC,SACZV,OAAO2C,KAAKD,YAAYlC,IAAK,WAW1B,GATI5C,aAAa+D,OAAO,CACvBC,KAAMhE,aAAaiE,MAAMC,QACzBC,KAAMW,YAAYlD,UACnBF,MAAK,SAAS0C,cACbA,MAAMC,UAAU3D,GAAGT,YAAYqE,OAAQF,MAAMG,QAAQC,KAAKJ,QAC1DA,MAAM3D,OACC"}