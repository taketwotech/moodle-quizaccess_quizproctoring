{"version":3,"file":"response_panel.min.js","sources":["../src/response_panel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript controller for the \"Grading\" panel at the right of the page\r\n *\r\n * @subpackage quizproctoring\r\n * @copyright  2020 Mahendra Soni <ms@taketwotechnologies.com> {@link https://taketwotechnologies.com}\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates'],\r\nfunction($, ModalFactory, ModalEvents, Templates) {\r\n    var init = function(attemptid = null, quizid = null, userid = null, useridentity = null, proctoringimageshow) {\r\n        var docElement = $(document);\r\n        docElement.ready(function() {\r\n            if (proctoringimageshow == 1) {\r\n                let btn = document.createElement(\"button\");\r\n                btn.innerHTML = M.util.get_string('proctoringimages', 'quizaccess_quizproctoring');\r\n                btn.setAttribute(\"type\", \"button\");\r\n                btn.setAttribute(\"value\", \"proctoringimage\");\r\n                btn.setAttribute(\"class\", \"proctoringimage btn btn-primary\");\r\n                btn.setAttribute(\"data-attemptid\", attemptid);\r\n                btn.setAttribute(\"data-quizid\", quizid);\r\n                btn.setAttribute(\"data-userid\", userid);\r\n                document.getElementById(\"page-content\").prepend(btn);\r\n            }\r\n            if (useridentity && useridentity != 0) {\r\n                let btnidentity = document.createElement(\"button\");\r\n                btnidentity.innerHTML = M.util.get_string('proctoringidentity', 'quizaccess_quizproctoring');\r\n                btnidentity.setAttribute(\"type\", \"button\");\r\n                btnidentity.setAttribute(\"value\", \"proctoridentity\");\r\n                btnidentity.setAttribute(\"class\", \"proctoridentity btn btn-primary\");\r\n                btnidentity.setAttribute(\"data-attemptid\", attemptid);\r\n                btnidentity.setAttribute(\"data-quizid\", quizid);\r\n                btnidentity.setAttribute(\"data-userid\", userid);\r\n                document.getElementById(\"page-content\").prepend(btnidentity);\r\n            }\r\n        });\r\n\r\n        docElement.on('click', 'button.proctoringimage', function(e) {\r\n            e.preventDefault();\r\n            var quizid = $(this).data('quizid');\r\n            var userid = $(this).data('userid');\r\n            var attemptid = $(this).data('attemptid');\r\n            $.ajax({\r\n                url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\r\n                data: {\r\n                    attemptid: attemptid,\r\n                    userid: userid,\r\n                    quizid: quizid\r\n                },\r\n                dataType: 'json',\r\n                success: function(response) {\r\n                    var images = JSON.parse(JSON.stringify(response));\r\n                    if (images.length > 0) {\r\n                        var data = {\r\n                            images: images.map(function(image) {\r\n                                return {\r\n                                    url: image.img,\r\n                                    title: image.title\r\n                                };\r\n                            })\r\n                        };\r\n\r\n                        Templates.render('quizaccess_quizproctoring/response_modal', data)\r\n                            .done(function(renderedHtml) {\r\n                                ModalFactory.create({\r\n                                type: ModalFactory.types.DEFAULT,\r\n                                body: renderedHtml,\r\n                                title: M.util.get_string('proctoringimages', 'quizaccess_quizproctoring')\r\n                            }).then(function(modal) {\r\n                                modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                                modal.show();\r\n                                lightbox.init();                        \r\n                            $('.image-link').on('click', function(event) {\r\n                                var titleElement = $(this).next('.image-title');\r\n                                titleElement.show();                            \r\n                                setTimeout(function() {\r\n                                    titleElement.hide();\r\n                                }, 1000);\r\n                                \r\n                                lightbox.start($(this)[0]);\r\n                            });\r\n                            $('.image-link').on('lightbox:open', function() {\r\n                                $(this).next('.image-title').hide();\r\n                            });\r\n                                   \r\n                            });\r\n                        })\r\n                        .fail(function() {\r\n                            console.error('Failed to render Mustache template');\r\n                        });\r\n                    } else {\r\n                        var message = M.util.get_string('noimageswarning', 'quizaccess_quizproctoring');\r\n                        ModalFactory.create({\r\n                            type: ModalFactory.types.DEFAULT,\r\n                            body: message\r\n                        }).then(function(modal) {\r\n                            modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                            modal.show();\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        docElement.on('click', 'button.proctoridentity', function(e) {\r\n            e.preventDefault();\r\n            $.ajax({\r\n                url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoridentity.php',\r\n                data: {\r\n                    attemptid: $(this).data('attemptid'),\r\n                    userid: $(this).data('userid'),\r\n                    quizid: $(this).data('quizid')\r\n                },\r\n                dataType: 'json',\r\n                success: function(response) {\r\n                    var residentity = JSON.parse(JSON.stringify(response));\r\n                    if (residentity.success) {\r\n                        window.open(residentity.url, \"_blank\");\r\n                    } else {\r\n                        return ModalFactory.create({\r\n                            type: ModalFactory.types.DEFAULT,\r\n                            body: residentity.message,\r\n                        }).then(function(modal) {\r\n                            modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\r\n                            modal.show();\r\n                            return null;\r\n                        });\r\n                    }\r\n                    return true;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","init","attemptid","quizid","userid","useridentity","proctoringimageshow","docElement","document","ready","btn","createElement","innerHTML","M","util","get_string","setAttribute","getElementById","prepend","btnidentity","on","e","preventDefault","this","data","ajax","url","cfg","wwwroot","dataType","success","response","images","JSON","parse","stringify","length","map","image","img","title","render","done","renderedHtml","create","type","types","DEFAULT","body","then","modal","getRoot","hidden","destroy","bind","show","lightbox","event","titleElement","next","setTimeout","hide","start","fail","console","error","message","residentity","window","open"],"mappings":"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"}